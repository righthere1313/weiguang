<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>天气排序</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 
     城市results[0].location.name，
     温度results[0].now.temperature，
     天气results[0].now.text 
     -->
     <div class="weather">
        <!-- 展示天气 -->
        <ul class="display">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
        <p></p>
        <!-- 排序按钮 -->
        <button>温度升序排序</button>
        <button>温度降序排序</button>
    </div>
</body>
<!-- 获取数据和排序 -->
<script>
    const btn=document.querySelectorAll('button');
    const cities=["北京","上海","苏州","深圳","成都","重庆","珠海"]
    let information = [];
    const lis = document.querySelectorAll('li');
    const p=document.querySelector('p');

    //渲染
    function render(){
        for (let i = 0; i < cities.length; i++) {
            if(information[i] && information[i].name){
                lis[i].innerHTML =
                    `<div class="name">${information[i].name}</div>
                <div>
                    <div class="text">${information[i].text}</div>
                    <div class="temperature">${information[i].temperature}°C</div>
                </div>`;
                p.innerHTML='';
            }else {
                lis[i].innerHTML = '<div class="error">数据走丢了</div>';
                console.log(`城市 ${cities[i]} 的天气数据缺失`);
                p.innerHTML='再按一次试试看';
            }
        } 
    }

    //天气排序准备
    function orderWeather(text) {
            if (text.includes('晴')) return 1;
            if (text.includes('多云')) return 2;
            if (text.includes('雾')) return 3;
            if (text.includes('阴')) return 4;
            if (text.includes('雨')) return 5;
        }

    //获得数据
    async function fetchData(){
        try{
            for (let i = 0; i < cities.length; i++) {
                const response = await fetch(`https://api.seniverse.com/v3/weather/now.json?key=SWJEEWD_M17tT3zGk&location=${cities[i]}`, {
                    method: 'GET'
                })
                if (response.status === 404|| response.status === 403) {
                    throw new Error('要疯了');
                }
                data = await response.json();

                information.push({
                    name: data.results[0].location.name,
                    text: data.results[0].now.text,
                    temperature: data.results[0].now.temperature
                })
            }
        }catch(error){
            console.log('出错了！请刷新');
        }
    }

    fetchData();

    //温度降序排序
    btn[0].addEventListener('click',()=>{
        information.sort((a,b)=>{
            if(parseInt(a.temperature) !== parseInt(b.temperature)){
                return parseInt(b.temperature) - parseInt(a.temperature);
            }
            return orderWeather(a.text)-orderWeather(b.text);
        })
        console.log(information);
        render();
    });

    //温度升序排序
    btn[1].addEventListener('click', () => {
        information.sort((a, b) => {
            if (parseInt(a.temperature) !== parseInt(b.temperature)) {
                return parseInt(a.temperature) - parseInt(b.temperature);
            }
            return orderWeather(a.text) - orderWeather(b.text);
        })
        console.log(information);
        render();
    });

</script>

</html>